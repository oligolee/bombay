steps:
   - name: gcr.io/cloud-builders/gcloud
     args:
     - kms
     - decrypt
     - --ciphertext-file=.env.enc
     - --plaintext-file=.env
     - --location=global
     - --keyring=capturio-keyring
     - --key=cloudbuild-env-config
# Build the container image
   - name: 'gcr.io/cloud-builders/docker'
     args: ['build', '-t', 'gcr.io/$PROJECT_ID/github-webhooks', '.']
# Push the image to Container Registry
   - name: 'gcr.io/cloud-builders/docker'
     args: ['push', 'gcr.io/$PROJECT_ID/github-webhooks']
# Deploy image to Cloud Run
   - name: 'gcr.io/cloud-builders/gcloud'
     args:
     - 'run'
     - 'deploy'
     - 'github-webhooks'
     - '--image'
     - 'gcr.io/$PROJECT_ID/github-webhooks'
     - '--region'
     - 'us-east1'
     - '--platform'
     - 'managed'
images:
   - gcr.io/$PROJECT_ID/github-webhooks
